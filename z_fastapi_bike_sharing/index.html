<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>首爾單車需求 AI 預測系統</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .dashboard { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); width: 100%; max-width: 700px; }
        h1 { text-align: center; color: var(--primary); margin-bottom: 40px; font-size: 26px; }
        
        /* 兩欄佈局 */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 20px; }
        .column-title { font-size: 15px; font-weight: bold; color: var(--accent); margin-bottom: 25px; border-left: 4px solid var(--accent); padding-left: 12px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* 輸入項樣式 */
        .input-group { margin-bottom: 22px; }
        .input-group:last-child { margin-bottom: 0; } /* 移除最後一項的間距以利對齊 */
        
        label { display: block; font-size: 14px; margin-bottom: 8px; color: #666; font-weight: 600; }
        input, select { width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 15px; background: #fafafa; transition: all 0.3s; }
        input:focus, select:focus { border-color: var(--accent); background: white; outline: none; box-shadow: 0 0 8px rgba(52,152,219,0.15); }
        
        /* 右側欄位特別對齊高度 */
        .right-col { display: flex; flex-direction: column; }
        .spacer { flex-grow: 1; } /* 自動填充中間空白，推擠下方欄位 */

        button { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 18px; cursor: pointer; margin-top: 20px; font-weight: bold; box-shadow: 0 4px 15px rgba(44,62,80,0.2); transition: 0.3s; }
        button:hover { background: #34495e; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(44,62,80,0.3); }
        
        #resultBox { margin-top: 35px; padding: 25px; border-radius: 15px; background: #f0f7ff; display: none; text-align: center; border: 1px solid #d0e4ff; }
        .count { font-size: 60px; font-weight: 800; color: var(--accent); margin: 5px 0; }
        .status-text { color: #5d6d7e; font-weight: 500; font-size: 14px; }
    </style>
</head>
<body>

<div class="dashboard">
    <h1><i class="fa-solid fa-square-poll-vertical"></i> 城市單車需求 AI 預算系統</h1>
    
    <div class="main-grid">
        <div class="left-col">
            <div class="column-title">時間維度</div>
            <div class="input-group">
                <label><i class="fa-solid fa-calendar-check"></i> 月份設定</label>
                <select id="month"></select>
            </div>
            <div class="input-group">
                <label><i class="fa-solid fa-calendar-day"></i> 星期設定</label>
                <select id="day_of_week">
                    <option value="0">週一 (Monday)</option>
                    <option value="1">週二 (Tuesday)</option>
                    <option value="2">週三 (Wednesday)</option>
                    <option value="3">週四 (Thursday)</option>
                    <option value="4">週五 (Friday)</option>
                    <option value="5">週六 (Saturday)</option>
                    <option value="6">週日 (Sunday)</option>
                </select>
            </div>
            <div class="input-group">
                <label><i class="fa-solid fa-clock"></i> 小時 (0-23)</label>
                <input type="number" id="hour" min="0" max="23">
            </div>
        </div>

        <div class="right-col">
            <div class="column-title">環境維度</div>
            <div class="input-group">
                <label><i class="fa-solid fa-temperature-three-quarters"></i> 目前溫度 (°C)</label>
                <input type="number" id="temp" step="0.1" value="20">
            </div>
            
            <div class="spacer"></div>
            
            <div class="input-group">
                <label><i class="fa-solid fa-cloud-sun-rain"></i> 天氣狀況描述</label>
                <select id="weather_type">
                    <option value="sunny">大晴天 (Sunny)</option>
                    <option value="cloudy">多雲/陰天 (Cloudy)</option>
                    <option value="rainy">雨天 (Rainy)</option>
                    <option value="snowy">雪天 (Snowy)</option>
                </select>
            </div>
        </div>
    </div>

    <button onclick="predictDemand()">運行深度預測分析</button>

    <div id="resultBox">
        <p style="margin:0; color:#95a5a6; font-size: 14px;">AI 預估租借量</p>
        <div class="count" id="predictCount">0</div>
        <p id="statusMsg" class="status-text"></p>
    </div>
</div>

<script>
    // 初始化下拉選單
    const monthSelect = document.getElementById('month');
    for(let i=1; i<=12; i++) {
        let opt = document.createElement('option');
        opt.value = i; opt.innerHTML = i + '月 (Month ' + i + ')';
        monthSelect.appendChild(opt);
    }
    
    // 自動帶入當前時間
    const now = new Date();
    document.getElementById('month').value = now.getMonth() + 1;
    document.getElementById('hour').value = now.getHours();
    document.getElementById('day_of_week').value = (now.getDay() + 6) % 7;

    async function predictDemand() {
        const month = parseInt(document.getElementById('month').value);
        const weather = document.getElementById('weather_type').value;
        const tempVal = parseFloat(document.getElementById('temp').value);
        
        // 1. 季節對應
        let seasons = 1; 
        if ([3,4,5].includes(month)) seasons = 1;
        else if ([6,7,8].includes(month)) seasons = 2;
        else if ([9,10,11].includes(month)) seasons = 0;
        else seasons = 3;

        // 2. 氣象參數對應
        let p = { hum: 50, sol: 1.5, rain: 0, snow: 0, wind: 1.5, t: tempVal };
        if (weather === 'sunny') { p.hum = 40; p.sol = 2.5; }
        else if (weather === 'cloudy') { p.hum = 60; p.sol = 0.5; }
        else if (weather === 'rainy') { p.hum = 85; p.sol = 0; p.rain = 2.0; }
        else if (weather === 'snowy') { p.hum = 90; p.sol = 0; p.snow = 1.0; if(p.t > 0) p.t = -1.0; }

        const payload = {
            hour: parseInt(document.getElementById('hour').value),
            temp: p.t,
            humidity: p.hum,
            wind_speed: p.wind,
            solar_rad: p.sol,
            rainfall: p.rain,
            snowfall: p.snow,
            seasons: seasons,
            holiday: 1, 
            month: month,
            day_of_week: parseInt(document.getElementById('day_of_week').value)
        };

        try {
            const response = await fetch('http://127.0.0.1:8000/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            document.getElementById('resultBox').style.display = 'block';
            document.getElementById('predictCount').innerText = data.predicted_count + ' 輛';
            document.getElementById('statusMsg').innerText = "模型推理成功：已整合時間規律與當前氣候因子。";
        } catch (error) {
            alert('無法連線到預測伺服器，請確認後端是否已開啟 (uvicorn)');
        }
    }
</script>

</body>
</html>