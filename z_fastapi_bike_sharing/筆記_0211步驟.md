## 目標是**「共享單車需求預測」**，並整合進網頁前端。

根據你的要求，我們分為兩部分：首先是**後續開發計畫清單**，接著是專為 `SeoulBikeData.csv`[https://archive.ics.uci.edu/dataset/560/seoul+bike+sharing+demand] 設計的**自動化清洗與訓練腳本**。



## **一、 後續開發步驟清單**

### 1. **Step 1: 數據建模與持久化（即本次內容）**
* 編寫 Python 腳本讀取 CSV 。


* 進行特徵工程（處理日期、轉碼類別變數）。


* 訓練模型並導出 `.joblib` 模型檔。


### 2. **Step 2: FastAPI 後端邏輯重構**
* 修改 `main.py` 以載入新的單車模型。
* 定義 Pydantic 數據模型，接收前端傳來的環境參數（溫度、小時等）。


### 3. **Step 3: 前端網頁介面優化**
* 更新 `index.html` 的輸入欄位，改為滑桿或下拉選單（如：選擇小時、天氣）。
* 調整顯示結果，從「推薦地點」改為「預測租借數量」與「調度建議」。


### 4. **Step 4: 重新部署至 Render**
* 將更新後的代碼推送至 GitHub。
* 確保 `requirements.txt` 包含 `scikit-learn` 與 `pandas`。



---

## **二、 自動化清洗與訓練腳本 (`train.py`)**

這個腳本會自動處理 `SeoulBikeData.csv` 中的日期格式，並將季節、假日等文字轉換為機器學習能理解的數字 。

```python
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestRegressor
from sklearn.preprocessing import LabelEncoder
import joblib

def train_bike_model():
    # 1. 讀取數據 (處理可能編碼問題)
    df = pd.read_csv('SeoulBikeData.csv', encoding='unicode_escape')
    
    # 2. 特徵工程 (Feature Engineering)
    # 將日期字串轉換為月份與週幾
    df['Date'] = pd.to_datetime(df['Date'], format='%d/%m/%Y')
    df['Month'] = df['Date'].dt.month
    df['DayOfWeek'] = df['Date'].dt.dayofweek
    
    # 3. 類別資料轉碼 (Label Encoding)
    le = LabelEncoder()
    df['Seasons'] = le.fit_transform(df['Seasons'])      # Winter, Spring, etc.
    df['Holiday'] = le.fit_transform(df['Holiday'])      # Holiday, No Holiday
    df['Functioning Day'] = le.fit_transform(df['Functioning Day']) # Yes, No
    
    # 4. 定義特徵 (選取對預測最關鍵的欄位)
    # 我們選取：小時, 溫度, 濕度, 風速, 太陽輻射, 雨量, 雪量, 季節, 是否假日, 月份, 週幾
    features = [
        'Hour', 'Temperature(蚓)', 'Humidity(%)', 'Wind speed (m/s)', 
        'Solar Radiation (MJ/m2)', 'Rainfall(mm)', 'Snowfall (cm)', 
        'Seasons', 'Holiday', 'Month', 'DayOfWeek'
    ]
    
    X = df[features]
    y = df['Rented Bike Count'] # 目標值：租借數量
    
    # 5. 拆分訓練與測試集
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
    
    # 6. 訓練模型 (採用隨機森林回歸)
    model = RandomForestRegressor(n_estimators=100, random_state=42)
    model.fit(X_train, y_train)
    
    # 7. 評估與保存
    score = model.score(X_test, y_test)
    print(f"模型訓練完成，R2 準確率為: {score:.4f}")
    
    # 保存模型供 FastAPI 使用
    joblib.dump(model, 'seoul_bike_model.joblib')
    # 同時保存特徵清單，確保 API 調用時順序一致
    joblib.dump(features, 'features_list.joblib')
    print("模型檔案已導出：seoul_bike_model.joblib")

if __name__ == "__main__":
    train_bike_model()

```

---

### ## **本步驟核心重點**


**日期轉換**：將 `01/12/2017`  這種字串拆解成「月份」與「週幾」，因為單車需求在夏天與週末會有明顯規律。


**編碼處理**：CSV 檔案標題含有特殊符號（如 `蚓`），因此腳本使用了 `unicode_escape` 編碼讀取以避免報錯。


**特徵對齊**：保存了 `features_list.joblib`，這能保證未來你的 FastAPI 接收數據後，餵給模型的欄位順序完全正確。

