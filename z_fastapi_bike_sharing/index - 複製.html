<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>城市單車需求AI預估</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f9; --bike-color: #e67e22; --btn-gray: #95a5a6; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 10px; }
        .dashboard { background: white; padding: 20px 40px 40px 40px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); width: 100%; max-width: 700px; margin-top: 10px;}
        
        /* 固定標題與彩色 LOGO */
        h1 { text-align: center; color: var(--primary); margin-top: 0; margin-bottom: 20px; font-size: 32px; }
        .bike-logo { color: var(--bike-color); margin-right: 10px; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.1)); }
        
        /* 兩欄佈局 */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 5px; }
        .column-title { font-size: 20px; font-weight: bold; color: var(--accent); margin-bottom: 20px; border-left: 4px solid var(--accent); padding-left: 12px; }
        
        /* 輸入項樣式 (固定高度以對齊) */
        .input-group { margin-bottom: 10px; height: 75px; } 
        label { display: block; font-size: 14px; margin-bottom: 8px; color: #666; font-weight: 600; }
        input, select { width: 100%; padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 15px; background: #fafafa; }
        
        /* 按鈕樣式 */
        button { width: 100%; padding: 16px; background-color: #2980b9; color: white; border: none; border-radius: 12px; font-size: 24px; cursor: pointer; margin-top: 5px; font-weight: bold; transition: 0.3s; box-shadow: 0 4px 10px rgba(41, 128, 185, 0.2);}
        button:hover { background-color: #7f8c8d; transform: translateY(-2px); }

        #resultBox { margin-top: 10px; padding: 15px 25px; border-radius: 15px; background: #f0f7ff; display: none; text-align: center; border: 1px solid #d0e4ff; }
        .count { font-size: 60px; font-weight: 800; color: var(--accent); margin: 0px 0; }
    </style>
</head>
<body>

<div class="dashboard">
    <h1><i class="fa-solid fa-bicycle bike-logo"></i>城市單車需求AI預估</h1>
    
    <div class="main-grid">
        <div class="left-col">
            <div class="column-title">時間因素</div>
            <div class="input-group">
                <label><i class="fa-solid fa-calendar-check"></i> 月份</label>
                <select id="month"></select>
            </div>
            <div class="input-group">
                <label><i class="fa-solid fa-calendar-day"></i> 星期</label>
                <select id="day_of_week">
                    <option value="0">週一 (Monday)</option>
                    <option value="1">週二 (Tuesday)</option>
                    <option value="2">週三 (Wednesday)</option>
                    <option value="3">週四 (Thursday)</option>
                    <option value="4">週五 (Friday)</option>
                    <option value="5">週六 (Saturday)</option>
                    <option value="6">週日 (Sunday)</option>
                </select>
            </div>
            <div class="input-group">
                <label><i class="fa-solid fa-clock"></i> 小時 (0-23)</label>
                <input type="number" id="hour" min="0" max="23">
            </div>
        </div>

        <div class="right-col">
            <div class="column-title">環境因素</div>
            <div class="input-group">
                <label><i class="fa-solid fa-temperature-three-quarters"></i> 目前溫度 (°C)</label>
                <input type="number" id="temp" step="0.1" value="20">
            </div>
            <div class="input-group">
                <label><i class="fa-solid fa-cloud-sun-rain"></i> 天氣狀況</label>
                <select id="weather_type">
                    <option value="sunny">大晴天 (Sunny)</option>
                    <option value="cloudy">多雲/陰天 (Cloudy)</option>
                    <option value="rainy">雨天 (Rainy)</option>
                    <option value="snowy">雪天 (Snowy)</option>
                </select>
            </div>
            <div class="input-group"></div>
        </div>
    </div>

    <button onclick="predictDemand()">進行AI預測分析</button>

    <div id="resultBox">
        <p style="margin:0; color:#2c3e50; font-size: 24px;">預估租借量</p>
        <div class="count" id="predictCount">0</div>
        <p id="statusMsg" style="color: #5d6d7e; font-weight: 500; font-size: 14px;"></p>
    </div>
</div>

<script>
    const monthSelect = document.getElementById('month');
    for(let i=1; i<=12; i++) {
        let opt = document.createElement('option');
        opt.value = i; opt.innerHTML = i + '月';
        monthSelect.appendChild(opt);
    }
    
    const now = new Date();
    document.getElementById('month').value = now.getMonth() + 1;
    document.getElementById('hour').value = now.getHours();
    document.getElementById('day_of_week').value = (now.getDay() + 6) % 7;

    async function predictDemand() {
        const month = parseInt(document.getElementById('month').value);
        const weather = document.getElementById('weather_type').value;
        const tempVal = parseFloat(document.getElementById('temp').value);
        
        let seasons = 1; 
        if ([3,4,5].includes(month)) seasons = 1;
        else if ([6,7,8].includes(month)) seasons = 2;
        else if ([9,10,11].includes(month)) seasons = 0;
        else seasons = 3;

        let p = { hum: 50, sol: 1.5, rain: 0, snow: 0, wind: 1.5, t: tempVal };
        if (weather === 'sunny') { p.hum = 40; p.sol = 2.5; }
        else if (weather === 'cloudy') { p.hum = 60; p.sol = 0.5; }
        else if (weather === 'rainy') { p.hum = 85; p.sol = 0; p.rain = 2.0; }
        else if (weather === 'snowy') { p.hum = 90; p.sol = 0; p.snow = 1.0; if(p.t > 0) p.t = -1.0; }

        const payload = {
            hour: parseInt(document.getElementById('hour').value),
            temp: p.t,
            humidity: p.hum,
            wind_speed: p.wind,
            solar_rad: p.sol,
            rainfall: p.rain,
            snowfall: p.snow,
            seasons: seasons,
            holiday: 1, 
            month: month,
            day_of_week: parseInt(document.getElementById('day_of_week').value)
        };

        try {
            const response = await fetch('http://127.0.0.1:8000/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            document.getElementById('resultBox').style.display = 'block';
            document.getElementById('predictCount').innerText = data.predicted_count + ' 輛';
            document.getElementById('statusMsg').innerText = "模型推理成功：已整合時間與環境因子。";
        } catch (error) {
            alert('無法連線到預測伺服器');
        }
    }
</script>

</body>
</html>